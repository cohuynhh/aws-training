## Dessigning high available and cost efficient cloud solutions

### Elasticity and Scalability
  * States
    * High Availability
	* Cost Efficient
	* Fualt Tolerant
  * Elasticity is the core dessign principle that tied the before "3 states"
  * Between regions costs go up
  * RTO. Recovery Time Objective. Or Business Continuity Planning
  * HA Top 10 ... or HAt10
	* 10. Regions
	* 09. AZ
	* 08. VPC
	* 07. ELB
	* 06. SQS
	* 05. EC2
	* 04. Elastic IP
	* 03. Route 53
	* 02. CloudWatch
	* 01. Auto Scaling

### AWS Well architecture Framework
  * Pillars
    * Security
	* Reliability
	* Performance Efficiency
	* Cost Optimization
  * Regions HAt10#10
    * 15 Regions
	* Isolated one each other
	* Billong is not tied to
	* from console you have to select one

**AWS CLI**  	
`$ aws ec2 describe-regions`
`$ aws ec2 configure`	

### AZ's HAt10#9
* Distinct geographical locations within regions
* Isolated
* Different electrical grids, risk profile, flood plains, etc.
* LAN connection between them
	
* **Region & AZ**
  * AMI     -- are tie to --> Regions
  * Elastic IP			--> Regions. Max 5/regions
  * Sec. Groups			--> Regions. Max 500/regions
  * EBS Snapshots			--> Regions
  * EBS volumes 			--> AZs
  * EC2 instances 		--> AZs, but 
  * EC2 instances "IDs"	--> Regions
	
### Amazon VPC HAt10#8
* USe Security Groups
* CIDR netmask /16 to /28
* IGW INternet Gateway
* Hardware VPN Connection
* VGW. Virtual Private Gateway
* CGW Customer Gateway
* Example: VPC -- VGW -- Hardware VPN Connection -- CGW -- inet
* RT Router Tables
* VPC Peering Connection
* VPC Endpoint (like to S3)
* CIDR Classless INter-Domain Routing
  * First 4 IP and last (255) are aws reserved
  * ex: subnet 10.0.0.0/24 --are reserved-->   
    10.0.0.0,10.0.0.1,10.0.0.2,10.0.0.3 y 10.0.0.255
* aws not support broadcast in VPC (255)
* each Subnet has one RT
* When create a subnet is associate with the main RT of the VPC, you can change it
* ACL Access Control List, or Network ACL
* Subnet must be associate with a ACL, if it is not with the defaul
* 200 Subnets per VPC
* IGW
  1) Provides a target in VPC to route traffic to inet
  2) Translation to instances with a public ip address
* Public Subnet: when is associate with a RT that has a route to an IGW
* You can create a VPN tunnel using IPsec to on-premise or co-locations
* Direct Connect (better than IPsec)
  * more predictable connectivity
  * is a private connection
  * uses 802.19 VLAN standard
* ACLs are subnet level control
  * SG instance level control
  * VPC has default ACL
  * ACL are stateless
  * Custom ACL deny all by default
  * Default ACL allow all by default
  * One ACL can have N subnet. One subnet must have just one ACL  1-N
* SG. Security Groups
  * Is a virtual Firewall for resources
  * Instance level control
  * You can "allow rules" but not deny rules
  * each resource to many SG
  * each resource has assingned a SG (the default al least)
  * are stateful
  * return traffic allowed by default
  * SG are associate with network interfaces
* Cmoparision SG--ACL
SG								ACL
* instance level				* subnet level
* allow rules only				* allow & deny rules
* stateful						* stateless
* return traffic allowed		* return traffic must be allowed with rules
* evaluate all rules before		* process rules in numeric ORDER
  decide
* apply only instances 			* apply to all in the subnet
  associated with
* First layer security			*Backup layer security
* No good for blocking			* Good for maliciouse Id/DooS hosts

* VPC Limits Summary
  * 5 VPC per Region
  * 5 IGW per Region
  * 5 Elastic IP addresses per Region
  * 10 VPN connections per VPC per VGW
  * 50 VPN connections per Region
  * 200 subnets per VPC
  * 500 SG per VPC per Region
  * Exists a default VPC in each region you can uses
    * Having a default Inet Gateway
	* Having a default ACL
	* Having a default RT

### Amazon ELB HAt10#7
* Improve fault tolerance
* balance traffic to multiple AZs
* HA by default service like S3 & SQS
* Internal or External
Cross-Zone reduce likelihood of client cache DNS into resulting in requests being distributed unevenly
* Improve availability & durability --> SSL offload, SSL Termination
* EC2-Classic listen on 25, 80, 443, 465, 587, 1024-65535
* EC2-VPC 1-65535
* You can control ciphers & protocols
* Layer-7 specific features relying on app http/s, like
  * x-forwarded
  * sticky session
* strict layer 4 load balancer for apps rely on TCP
* Associate SG with ELB
* Sticky Session specify specific instances using cookies generated by: ELB or App
  Maintain client state when sessions when they are not managed by Amazon Elasticached not Amazon DynamoDB
* CloudWatch monitoring Details
  - Storage logs in S3
  - 1 minute interval by default
* CloudTrail
  - To record ELB API calls
  - For security analysis, research change tracking and compliance auditing
  - (Ex Quarentine instances)Root cause analysis is smth doesen't get done by software
 
### Amazon SQS HAt10#6
* fully managed
* unlimited number of msgs
* no order guaranteed
* more than onece (WOW)
* msg visibility window up to 12 hs
* default retention period from 1 minute to 2 weeks. 4 days is default
* purge: deletes incoming msgs too
* CLoudWatch use SQS to trigger AutoScaling base on the number of msgs in your queries

### Amazon EC2 HAt10#5
* AMI
  * Types by publisher
    * Asw published
    * Aws marketplace (partners published)
    * Community
    * My AMIs (private)
  * Across regions
  * Private by default
* Instance Types 
  * Optimize by: COmpute, Memory, Network or I/O?
  * Sizes
  * Storage: Instance storage or EBS. Built from S3 or EBS.
  * Instance Storage can't stop.

COMPARISION		Instance Store-Backed			EBS- Backed
Boot time		< 5 min							< 1 min
Size limit		16 GiB							16 TiB
Charges			instance+S3						instance+ESB snapshot+S3
AMI CReation	AMI tools						Console
When to use		Temp Data
				Architecture provides redundancy like hadoop
				Encrypt temp data

  * Spot Instances over provisioned
  * IAM Role. Automatically deploy and rotate aws credentials
  * shutdown. Stop or terminate
  * accidental termination protections (except autoscaling)
  * Tenancy: Shared, Dedicated & Dedicated Host
  * User Data: #!/bin/bash: using 'aws s3 copy files!'
  * Instance Metadata
    http://169.254.169.254/latest/metadata
	with curl or get
  * Ephemeral storage is not set in that options (none ESB)
  * SSH or RDP
  * Instance States: Start, Stop, Reboot ot Terminate
  * Billed per Hour. Stop-->Running cycle full hour charge (No with reboot)
  

COMPARISION		Reboot			Stop/Start			Terminate
Host			same			different			None
Private IP		same			same (Classic new)	None
Public IP		same			different			None
EIP				same			same				Dissasociate
Instance Store  preserved		erased				erased
root-device		preserved		preserved			rease by default

* Purchase Options
  * On Demand: hourly
  * Spot: market price
  * Reserved: 1 to 3 years upfront
  * Scheduled: like reserved but 1 year
  * Data transfer charges
    * inet --> EC2 no charges
	* EC2 --> inet per GB in TB tiers
* Generation types
  * SIzes: nano, micro, small, medium, large, xlarge, 2xlarge
  * General Purpose
    * T2 low traffic web, dev env, no much CPU, burstable CPU (credits)
	* M0 medium, balance mem, cpu & ssd
	* M3 more CPU
  * Compute Optimize. C0 series
  * Memory Optimize. R3 series, not just size, improve mem speed
  * Storage Optimize. Low cost IOPS
  * Accelerate Computing. GPU (Mongo, Cassandra) G0, F0
  * AMazon EC2 Elastic GPU
* Placement Groups
  * Non for medium, nano or micro
  * Logical group within a AZ
  * Low latency 10 GiB per second network
  * Enhance Clusters Performance
  * Must be the same instance types
  * No additional costs
* System Manager
  * No additional costs
  * Run command
  * State Manager
  * Automations
* Limits per Region
  * 20 on demand
  * 20 reserved
  * some kind not available
* Supports
  * Amazon Linux
  * Ubuntu
  * Windows
  * Red Hat
  * Suse
  * Fedora
  * Debian
  * CentOs
  * Gentoo
  * Oracle Linux
  * FreeBSD
* EC2 Summary
  * AMIs: Types aws, partners, community, private
  * Instance types: cpu, memory, networking
  * Billing types: ondemand, spot, reserverd, scheduled
  * Instance Storage: difference between ephemeral store and EBS volume
  * The difference between EBS backed instances and instances store backed instances
  * The difference in instance states (start, stop, reboot and terminate)
  * Launch parameters and setting user data
  * EC2 LightSail
  * EC2 System Resource Manager
  * Placement Groups
  * Default limits
  * How EC2 helps us deseign high available, fault tolerant, cost effective solutions
### Route 53 HAt10#4
  * HA DNS
  * Geo Routing
  * DNS Failover with heralthchecks
  * Weighted routing by percentage
    - PErform Vlu-Green deployments
  * Combine with ELB in each region
  * You can add SGs
### EIP. Elastic IP Addresses HAt10#3
* Public IP address programnatically mapped
  Between instances within a Region
* Owned with a AWS account
* Associate to EC2 or VPC
* 5 per VPC per Region

### Amazon CloudWatch HAt10#2
* Monitoring
* CPU, DIsk, Network
* EC2... enabled by default
  * 7 preselected metrics @5 minutes
  * 3 status check metricks @1 minute
* Detailed Monitoring
* Retained 2 weeks
* Alarms
* Custom Metrics
* Using SNS or to AutoScaling
* Alarms States
  * Ok
  * Alarms
  * Insufficent Data

### Auto Scaling HAt10#1
* Provision Based on Actual Demand rather than estimated demand
* Health Checking Built-in
* Can Drop & Create instances
* Multiple AZ within a Region
* Horizontal scalability on demand or pre determined schedules
* Based on CloudWatch metrics
* Core Components
  * Launch COnfiguration
    * EC2 type, AMI, User Data, Key Pair, SG
	* Block Device Mapping
	* Auto scale group: min & max number of instances
	* Scaling Plan. When & How
	* Termination Policy. And you can create a custom one
* Instance Protection. 
  Not protect from manual termination initiated via the console or via API

## Developing Cloud Solutions

### Using Amazon SQS
* Order not guaranteed
* Max 256 Kb
* At `least` once
* Polling
  * Long wait till received msg is complete
  * Short (default) is receive msg wait time = 0
* Default Visibility Timeout
  * Available for single machine during the process time
  * visible only for the machine responsable
  * 0 secs to 12 hours
* Message Retention Period. 1 min to 14 days. Default 4 days
* Delivery Delay. 0 secs to 15 mins. Default 0
* Receive messgae wait time.
  * Max 20 secs
  * Default 0. Short Polling
* Re drive policiy is for error handling
* Dead Letter Queue. DLQ
* Permissions
  * Try with SNS
  * Send a message to SQS, Publishing to SNS topic
### Decoupling Layers
* Avoid SPoF (Single Point of Failure)
* Elasticity
* Small pieces
* High availability

* Sample Solution  
  * Not use sticky session, improves ELB
  * Use session saved in DynamoDB or Elasticached

* ElastiCache is in meme cache
  * Supports Memcached and Redis
  * Is managed. Automatic detects and replace failed
  * Managed directly the EC2 instance nodes
  * Cache DB or Web Sessions

Example with the Web Picture

### Using Amazon SWF. Simple Workflow Service
* Fully managed state tracker & task coordinator in the cloud
* Helps developers build, run and scale backgroud jobs that have parallel or sequential steps
* Allow human intervention
* Actors
  * WF Starters
  * Workers
  * Decider
* Task are predefined functions
* WF history is recorded (the events)
* Domain WF in differents domains can't interact
* SWF is likely used with programming languages and aws sdk
* Console have only basic stuff

### Using Amazon SNS
* Is a push notification service
* Individual messag to a large number of recipients (endpoints)
* Endpoints types: http/s, App, AwsLambda
* Json message generator
* Mobile Endpoint. App type, msg platform app
* Message Attributes
  * Type
  * MsgId
  * Topic ARN
  * Subject
  * Msg
  * Timestamp
  * SignatureVersion
  * Signature
  * Unsuscribe URL

### Using Cross Origin Resources (CORS)
* S3 related topics
  * Same origin policy
  * Pre-Signed object URL. to grant time-limited permission to download

DEMONSTRATION  
* S3 Static Web Files
  * Permissions for tip.jpeg
  * Add CORS configuration
  * Cyberduck (is a tool) to sign URL

### Amazon APIs
* Rest & HTTP
* SDK
  * Java
  * Javascript
  * Ruby
  * Python Boto
  * .Net
  * PHP
  * Android
  * iOS
  * Unity
* HTTP Responses
  * 1XX Informational
  * 2XX Sucessfule
  * 3XX Redirection
  * 4XX Client Error
  * 5XX Server Error

DEMONSTRATION  
  With Python Boto
  
### Knowledge Check Point
* Developer Exam Prep - High Availability
* Developer Exam Prep - ELB
* Developer Exam Prep - Route 53
* Developer Exam Prep - Auto Scaling









